---
title: "Get Started"
output: rmarkdown::html_vignette
bibliography: refs.bib
vignette: >
  %\VignetteIndexEntry{Get Started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(abslife)
library(ggplot2) ## optional
```

> This package is currently under construction!

This vignette demonstrates the core functionalities of the `abslife`
package. `abslife` provides tools for estimation of the hazard rate, denoted
$\lambda$, for discrete time-to-event data subject to **left-truncation**
[@lautier2023estimating]. The package is designed so it can additionally handle
the following common observational data challenges:

* **+ Right-censoring** [@lautier2023pricing] 

* **+ Competing risks** [@lautier2024convergence]

In all cases, asymptotic confidence intervals for the estimated hazard rates are
readily available. The main function of the package is the `estimate_hazard()`
function, which adapts to these scenarios based on the arguments provided.


Now, we provide specific examples with datasets shipped with the package.


## Left-truncation

We begin by analyzing the aart dataset. This dataset represents a scenario
involving only left-truncation. It contains two columns: `Xi` (time-to-event)
and `Yi` (truncation time).
```{r aart}
data(aart)
head(aart)
```

We estimate the hazard rate using `estimate_hazard()`.
```{r aart_est}
aart_hazard <- estimate_hazard(lifetime = aart$Xi,
                               trunc_time = aart$Yi,
                               ci_level = 0.95,
                               carry_hazard = TRUE) ## need 
```

> Note that, we set `carry_hazard = TRUE`. This argument ensures that if a
> hazard estimate is 0, it is replaced by the last non-zero estimate.


The function returns a `data.frame` containing the evaluation times, the hazard
estimates, and the standard errors (on the log scale). It also includes the
lower and upper bounds of the confidence interval corresponding to the `ci_level`
argument (in this case, set to 0.95).
```{r inspect_aest}
tail(aart_hazard)
```

> I believe we don't need to output the `fh` and `uh` columns. What do you
> think?


### Summarizing and plotting


For a concise overview of the estimation, use the `summary()` method:

```{r summary_aart}
summary(aart_hazard)
```

To visualize the hazard rate, you can use base R graphics via the `plot()`
method:

```{r plot_aart}
plot(aart_hazard, ci_level = c(.5, .75, .85, .9, .95))
```

Alternatively, use `ggauto()` for a `ggplot2`-powered visualization. This
function is particularly useful for visualizing multiple confidence levels
simultaneously:
```{r ggplot_aart}
ggauto(aart_hazard, ci_level = c(.5, .75, .85, .9, .95))
```

### Calculating the CDF

he package can also derive the Cumulative Distribution Function (CDF) directly
from the hazard estimates using `calc_cdf()`. This appends a cdf column to the
results.
```{r cdf_aart}
aart_cdf <- calc_cdf(aart_hazard)
summary(aart_cdf)
```

We can also plot the CDF:
```{r plot_cdf_aart}
plot(aart_cdf)
```

## Right-censoring

The workflow for right-censored data is nearly identical. We will demonstrate
this using the `mbalt` dataset, which includes a third column, `Di`, serving as
the right-censoring indicator.
```{r mbalt}
data(mbalt)
head(mbalt)
```

We call `estimate_hazard()` again, but this time we provide the censoring
argument. This argument accepts a vector where `1` indicates a censored
observation and `0` indicates an observed event.
```{r mbalt_est}
mbalt_hazard <- estimate_hazard(lifetime = mbalt$Zi,
                                trunc_time = mbalt$Yi,
                                censoring = mbalt$Di,
                                ci_level = 0.95,
                                carry_hazard = FALSE) ## need 
```

The output structure remains consistent with the previous example.
```{r summary_mbalt}
summary(mbalt_hazard)
```

The plotting functions also work out of the box:
```{r plot_mbalt}
plot(mbalt_hazard)
```

and, for `ggplot2`:
```{r ggplot_mbalt}
ggauto(mbalt_hazard, ci_level = c(.5, .75, .85, .9, .95))
```

## Competing risks

Finally, `abslife` can estimate hazards in the presence of competing risks. We
use the aloans dataset, which contains data on consumer automobile loans
[@lautier2024convergence].
```{r aloans}
data(aloans)
head(aloans)
```

The relevant columns of the dataset for this example are the following:

* `Z`: time to event

* `Y`: left-truncation

* `C`: right censoring indicator

* `D`: Default indicator (1 represents default, and 0 represents pre-payment)

The two competing risks in this case are default and pre-payment. To make the
results more interpretable, we create a descriptive event_type column.
```{r aloans_column}
aloans <- transform(aloans, event_type = ifelse(D == 1, "Defaut", "Pre-payment"))
```


The package is designed so the workflow is identical as the previous two
examples. The only change here is passing the column discriminating the event
types to the `event_type argument` in `estimate_hazard()`.
```{r aloans_est}
aloans_hazard <- estimate_hazard(lifetime = aloans$Z,
                                 trunc_time = aloans$Y,
                                 censoring = aloans$C,
                                 event_type = aloans$event_type,
                                 ci_level = 0.95,
                                 carry_hazard = FALSE) ## need 
```


The output now includes a column specifying the event type for each hazard
estimate.
```{r summary_aloans}
summary(aloans_hazard)
```

The plotting functions work as in the previous examples, handling the
stratification by event type automatically:
```{r plot_aloans}
plot(aloans_hazard)
```

The same holds for the `ggplot2` powered plots:
```{r ggplot_aloans}
ggauto(aloans_hazard, ci_level = c(.5, .75, .85, .9, .95)) +
  theme_bw()
```

# References
